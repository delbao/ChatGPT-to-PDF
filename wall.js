window.paywall={isInitialized:!1,paywallId:null,_initPromise:null,_eventHandlers:new Map,_paywallDocumentRoot:null,_observer:null,_overrideStyles:null,_iframeCreated:!1,init:function(t,e,a){return this._initPromise||(this.paywallId=t,this._paywallDocumentRoot=null!=a?a:document,window.addEventListener("message",this._globalEventHandler.bind(this),!1),this._initPromise=new Promise(t=>{this._addEventHandler("init",e=>{"state"===e.data.type&&(this.isInitialized=!0,this._removeEventHandler("init"),t(!0))})})),this._initPromise},_createAndAppendIframe:function(){this._iframeCreated||(this._iframeCreated=!0,window.requestAnimationFrame(()=>{let t=()=>{let t=document.createElement("iframe");t.src="".concat("https://onlineapp.pro","/paywall/").concat(this.paywallId,"?v=2.0.3"),t.id="paywall-".concat(this.paywallId),t.style.display="none";let e=this._paywallDocumentRoot.querySelector("body");e?e.appendChild(t):console.error("[PAYWALL ERROR] Paywall container not found")};"loading"===this._paywallDocumentRoot.readyState?this._paywallDocumentRoot.addEventListener("DOMContentLoaded",t):t()}))},_globalEventHandler:function(t){if(!this._iframeCreated)return;let e=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));if(t.source===(null==e?void 0:e.contentWindow))for(let[,a]of("change-styles"===t.data.type?Object.assign(e.style,{...t.data.style,...this._overrideStyles||{}}):"redirect"===t.data.type?window.open(t.data.redirectUrl):"remove"===t.data.type&&e.remove(),this._eventHandlers))a(t)},_addEventHandler:function(t,e){this._eventHandlers.set(t,e)},_removeEventHandler:function(t){this._eventHandlers.delete(t)},_ensureInitialized:async function(){return this.paywallId||this.init("343"),this.paywallId},_ensureIframeCreated:async function(){await this._ensureInitialized(),this._iframeCreated||(this._createAndAppendIframe(),this.isInitialized||await this._initPromise)},open:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{resolveEvent:"opened",paywallContainerId:void 0};return await this._ensureIframeCreated(),new Promise((e,a)=>{var n;if(this._addEventHandler("open",n=>{var i;if("state"===(null===(i=n.data)||void 0===i?void 0:i.type)&&["".concat("https://onlineapp.pro"),"https://onlineapp.live","https://onlineapp.stream"].includes(n.origin))if("invisible"===n.data.state.visibility_status&&"paid"!==n.data.state.purchase_status&&"tokenization-sign-in"!==n.data.state.visibility_status_reason)this._removeEventHandler("open"),a(n.data.state);else switch(t.resolveEvent){case"opened":"visible"===n.data.state.visibility_status?(this._removeEventHandler("open"),e(n.data.state)):"invisible"===n.data.state.visibility_status&&(this._removeEventHandler("open"),a(n.data.state));break;case"signed-in":"signed-in"===n.data.state.auth_status&&(this._removeEventHandler("open"),e(n.data.state));break;case"success-purchase":"paid"===n.data.state.purchase_status&&(this._removeEventHandler("open"),e(n.data.state))}}),null==t?void 0:t.paywallContainerId){let e=this._paywallDocumentRoot.getElementById(t.paywallContainerId);e?this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId))?(this._updateIframeStyles(e),new ResizeObserver(()=>{this._updateIframeStyles(e)}).observe(e)):console.warn("[PAYWALL ERROR] Paywall iframe not found"):console.warn("[PAYWALL ERROR] Specified container not found")}null===(n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===n||n.contentWindow.postMessage({action:"open"},"*")})},_updateIframeStyles:function(t){let e=t.getBoundingClientRect(),a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));this._overrideStyles={position:"absolute",top:"".concat(e.top+window.scrollY,"px"),left:"".concat(e.left+window.scrollX,"px"),width:"".concat(e.width,"px"),height:"".concat(e.height,"px")},a?(a.style.position="absolute",a.style.top="".concat(e.top+window.scrollY,"px"),a.style.left="".concat(e.left+window.scrollX,"px"),a.style.width="".concat(e.width,"px"),a.style.height="".concat(e.height,"px")):console.warn("[PAYWALL ERROR] Paywall iframe not found")},renew:async function(){return await this._ensureIframeCreated(),new Promise((t,e)=>{var a;this._addEventHandler("renew",a=>{var n;"state"===(null===(n=a.data)||void 0===n?void 0:n.type)&&["".concat("https://onlineapp.pro"),"https://onlineapp.live","https://onlineapp.stream"].includes(a.origin)&&("paid"===a.data.state.purchase_status?(this._removeEventHandler("renew"),t(a.data.state)):"closed-by-user"===a.data.state.visibility_status_reason&&(this._removeEventHandler("renew"),e(a.data.state)))}),null===(a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===a||a.contentWindow.postMessage({action:"renew"},"*")})},getUser:async function(){return await this._ensureIframeCreated(),this.makeRequest("".concat("https://onlineapp.pro","/api/v1/paywall/").concat(this.paywallId,"/user"))},signOut:async function(){return await this._ensureIframeCreated(),this.makeRequest("".concat("https://onlineapp.pro","/api/signout"),{method:"POST"})},destroy:async function(){await this._ensureIframeCreated();let t=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==t||t.remove()},setUserMetadata:async function(t){await this._ensureIframeCreated();let e=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==e||e.contentWindow.postMessage({type:"SET_USER_METADATA",metadata:t},"*")},getTrialInfo:async function(){return await this._ensureIframeCreated(),new Promise((t,e)=>{let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),n=Date.now();this._addEventHandler("request_".concat(n),a=>{a.data.requestId===n&&(this._removeEventHandler("request_".concat(n)),a.data.error?e(a.data.error):t(a.data.response))}),null==a||a.contentWindow.postMessage({type:"GET_TRIAL_INFO",requestId:n},"*")})},makeRequest:async function(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return await this._ensureIframeCreated(),new Promise((i,s)=>{let o=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),l=Date.now();this._addEventHandler("request_".concat(l),t=>{t.data.requestId===l&&(this._removeEventHandler("request_".concat(l)),t.data.error?s(t.data.error):i(t.data.response))}),null==o||o.contentWindow.postMessage({type:"MAKE_REQUEST",url:t,options:e,requestId:l,useFormData:n},"*"),a&&(a.abort=()=>{this._abortRequest(l)})})},makeStreamRequest:async function*(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];await this._ensureIframeCreated();let i=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),s=Date.now();this._addEventHandler("stream_".concat(s),t=>new Promise((e,a)=>{var n,i;t.data.requestId===s?(null===(i=t.data)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.error)?a(t.data.data.error):e({chunk:t.data.chunk,done:t.data.done}):e(null)})),null==i||i.contentWindow.postMessage({type:"MAKE_STREAM_REQUEST",url:t,options:e,requestId:s,useFormData:n},"*"),a&&(a.abort=()=>{this._abortRequest(s)});try{for(;;){let t=await new Promise((t,e)=>{this._addEventHandler("stream_message_".concat(s),a=>{var n,i;a.data.requestId===s&&((null===(i=a.data)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.error)?e(a.data.data.error):t(a.data))})});if(t.done)break;t.chunk&&(yield t.chunk)}}finally{this._removeEventHandler("stream_".concat(s)),this._removeEventHandler("stream_message_".concat(s))}},_abortRequest:function(t){var e;let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==a||null===(e=a.contentWindow)||void 0===e||e.postMessage({type:"ABORT_REQUEST",requestId:t},"*")}};